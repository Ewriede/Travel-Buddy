{% extends "base.html" %}
{% block content %}
  <h2>Create a New Travel Plan</h2>
  <form method="POST">
    <input name="name" placeholder="Plan Name" required><br>
    <input name="budget" placeholder="Budget" required><br>
    <input name="time_needed" placeholder="Time Needed" required><br>
    <input name="group_rec" placeholder="Group Size" required><br>

    <label>Destination:</label>
    <select name="destination" id="destination">
        {% for dest in destinations %}
        <option value="{{ dest.id }}">{{ dest.name }}</option>
        {% endfor %}
    </select><br>

    <div id="activity-fields">
        <select name="activities">
        </select>
    </div>

    <button type="button" id="add-activity">Add Another Activity</button><br><br>
    <button type="submit">Submit</button>
</form>

<script>
let activityOptions = [];

document.getElementById("destination").addEventListener("change", function () {
    const id = this.value;
    fetch(`/get_activities/${id}`)
        .then(response => response.json())
        .then(data => {
            activityOptions = data;
            const container = document.getElementById("activity-fields");
            container.innerHTML = ''; // Clear existing fields

            // Add initial dropdown
            addActivityDropdown();
        });
});

function addActivityDropdown() {
    const container = document.getElementById("activity-fields");

    const wrapper = document.createElement("div");
    wrapper.className = "activity-wrapper";

    const select = document.createElement("select");
    select.name = "activities";
    activityOptions.forEach(a => {
        const opt = document.createElement('option');
        opt.value = a.id;
        opt.textContent = a.name;
        select.appendChild(opt);
    });

    const removeButton = document.createElement("button");
    removeButton.type = "button";
    removeButton.textContent = "Remove";
    removeButton.addEventListener("click", () => {
        wrapper.remove();
    });

    wrapper.appendChild(select);
    wrapper.appendChild(removeButton);
    container.appendChild(wrapper);
}

document.getElementById("add-activity").addEventListener("click", () => {
    addActivityDropdown();
});
</script>
{% endblock %}